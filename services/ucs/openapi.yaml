components:
  schemas:
    BoxCreationRequest:
      description: Request body for creating a new FileUploadBox.
      properties:
        storage_alias:
          description: The storage alias to use for this upload box
          title: Storage Alias
          type: string
      required:
      - storage_alias
      title: Box Creation Request
      type: object
    BoxUpdateRequest:
      description: Request body for updating a FileUploadBox.
      properties:
        lock:
          description: Whether the box should be locked (true) or unlocked (false)
          title: Lock
          type: boolean
      required:
      - lock
      title: Box Update Request
      type: object
    FileUpload:
      description: A File Upload.
      properties:
        alias:
          description: The submitted alias from the metadata (unique within the box)
          title: Alias
          type: string
        box_id:
          description: The ID of the FileUploadBox this FileUpload belongs to
          format: uuid4
          title: Box Id
          type: string
        checksum:
          description: Unencrypted checksum
          title: Checksum
          type: string
        completed:
          default: false
          description: Whether or not the file upload has finished
          title: Completed
          type: boolean
        id:
          description: Unique identifier for the file upload
          format: uuid4
          title: Id
          type: string
        size:
          description: File size in bytes
          title: Size
          type: integer
        state:
          $ref: '#/components/schemas/FileUploadState'
          default: init
          description: The state of the FileUpload
      required:
      - id
      - box_id
      - alias
      - checksum
      - size
      title: FileUpload
      type: object
    FileUploadBox:
      description: A class representing a box that bundles files belonging to the
        same upload.
      properties:
        file_count:
          default: 0
          description: The number of files in the box
          title: File Count
          type: integer
        id:
          description: Unique identifier for the instance
          format: uuid4
          title: Id
          type: string
        locked:
          default: false
          description: Whether or not changes to the files in the box are allowed
          title: Locked
          type: boolean
        size:
          default: 0
          description: The total size of all files in the box
          title: Size
          type: integer
        storage_alias:
          description: S3 storage alias to use for uploads
          title: Storage Alias
          type: string
      required:
      - id
      - storage_alias
      title: FileUploadBox
      type: object
    FileUploadCompletionRequest:
      description: Request body for completing a FileUpload.
      properties:
        encrypted_checksum:
          description: The checksum of the encrypted file
          title: Encrypted Checksum
          type: string
        unencrypted_checksum:
          description: The checksum of the unencrypted file
          title: Unencrypted Checksum
          type: string
      required:
      - unencrypted_checksum
      - encrypted_checksum
      title: File Upload Completion Request
      type: object
    FileUploadCreationRequest:
      description: Request body for creating a new FileUpload.
      properties:
        alias:
          description: The alias for the file within the box (must be unique within
            the box)
          title: Alias
          type: string
        size:
          description: The size of the file in bytes
          minimum: 1.0
          title: Size
          type: integer
      required:
      - alias
      - size
      title: File Upload Creation Request
      type: object
    FileUploadState:
      description: 'The allowed states for a ResearchDataUploadBox instance.


        init: file upload initiated, but not yet finished

        inbox: file upload complete, file in inbox

        archived: file moved out of inbox after completion'
      enum:
      - init
      - inbox
      - archived
      title: FileUploadState
      type: string
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          title: Detail
          type: array
      title: HTTPValidationError
      type: object
    HttpBoxNotFoundError:
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/HttpBoxNotFoundErrorData'
        description:
          description: A human readable message to the client explaining the cause
            of the exception.
          title: Description
          type: string
        exception_id:
          const: boxNotFound
          title: Exception Id
          type: string
      required:
      - data
      - description
      - exception_id
      title: HttpBoxNotFoundError
      type: object
    HttpBoxNotFoundErrorData:
      properties:
        box_id:
          format: uuid4
          title: Box Id
          type: string
      required:
      - box_id
      title: HttpBoxNotFoundErrorData
      type: object
    HttpChecksumMismatchError:
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/HttpChecksumMismatchErrorData'
        description:
          description: A human readable message to the client explaining the cause
            of the exception.
          title: Description
          type: string
        exception_id:
          const: checksumMismatch
          title: Exception Id
          type: string
      required:
      - data
      - description
      - exception_id
      title: HttpChecksumMismatchError
      type: object
    HttpChecksumMismatchErrorData:
      properties:
        file_id:
          format: uuid4
          title: File Id
          type: string
      required:
      - file_id
      title: HttpChecksumMismatchErrorData
      type: object
    HttpFileUploadNotFoundError:
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/HttpFileUploadNotFoundErrorData'
        description:
          description: A human readable message to the client explaining the cause
            of the exception.
          title: Description
          type: string
        exception_id:
          const: fileUploadNotFound
          title: Exception Id
          type: string
      required:
      - data
      - description
      - exception_id
      title: HttpFileUploadNotFoundError
      type: object
    HttpFileUploadNotFoundErrorData:
      properties:
        file_id:
          format: uuid4
          title: File Id
          type: string
      required:
      - file_id
      title: HttpFileUploadNotFoundErrorData
      type: object
    HttpLockedBoxError:
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/HttpLockedBoxErrorData'
        description:
          description: A human readable message to the client explaining the cause
            of the exception.
          title: Description
          type: string
        exception_id:
          const: lockedBox
          title: Exception Id
          type: string
      required:
      - data
      - description
      - exception_id
      title: HttpLockedBoxError
      type: object
    HttpLockedBoxErrorData:
      properties:
        box_id:
          format: uuid4
          title: Box Id
          type: string
      required:
      - box_id
      title: HttpLockedBoxErrorData
      type: object
    HttpNotEnoughSpaceError:
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/HttpNotEnoughSpaceErrorData'
        description:
          description: A human readable message to the client explaining the cause
            of the exception.
          title: Description
          type: string
        exception_id:
          const: notEnoughSpace
          title: Exception Id
          type: string
      required:
      - data
      - description
      - exception_id
      title: HttpNotEnoughSpaceError
      type: object
    HttpNotEnoughSpaceErrorData:
      properties:
        box_id:
          format: uuid4
          title: Box Id
          type: string
        file_alias:
          title: File Alias
          type: string
        file_size:
          title: File Size
          type: integer
        remaining_space:
          title: Remaining Space
          type: integer
      required:
      - box_id
      - file_alias
      - file_size
      - remaining_space
      title: HttpNotEnoughSpaceErrorData
      type: object
    HttpS3UploadDetailsNotFoundError:
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/HttpS3UploadDetailsNotFoundErrorData'
        description:
          description: A human readable message to the client explaining the cause
            of the exception.
          title: Description
          type: string
        exception_id:
          const: s3UploadDetailsNotFound
          title: Exception Id
          type: string
      required:
      - data
      - description
      - exception_id
      title: HttpS3UploadDetailsNotFoundError
      type: object
    HttpS3UploadDetailsNotFoundErrorData:
      properties:
        file_id:
          format: uuid4
          title: File Id
          type: string
      required:
      - file_id
      title: HttpS3UploadDetailsNotFoundErrorData
      type: object
    HttpS3UploadNotFoundError:
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/HttpS3UploadNotFoundErrorData'
        description:
          description: A human readable message to the client explaining the cause
            of the exception.
          title: Description
          type: string
        exception_id:
          const: s3UploadNotFound
          title: Exception Id
          type: string
      required:
      - data
      - description
      - exception_id
      title: HttpS3UploadNotFoundError
      type: object
    HttpS3UploadNotFoundErrorData:
      additionalProperties: true
      properties: {}
      title: HttpS3UploadNotFoundErrorData
      type: object
    HttpUnknownStorageAliasError:
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/HttpUnknownStorageAliasErrorData'
        description:
          description: A human readable message to the client explaining the cause
            of the exception.
          title: Description
          type: string
        exception_id:
          const: noSuchStorage
          title: Exception Id
          type: string
      required:
      - data
      - description
      - exception_id
      title: HttpUnknownStorageAliasError
      type: object
    HttpUnknownStorageAliasErrorData:
      additionalProperties: true
      properties: {}
      title: HttpUnknownStorageAliasErrorData
      type: object
    HttpUploadAbortError:
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/HttpUploadAbortErrorData'
        description:
          description: A human readable message to the client explaining the cause
            of the exception.
          title: Description
          type: string
        exception_id:
          const: uploadAbortError
          title: Exception Id
          type: string
      required:
      - data
      - description
      - exception_id
      title: HttpUploadAbortError
      type: object
    HttpUploadAbortErrorData:
      additionalProperties: true
      properties: {}
      title: HttpUploadAbortErrorData
      type: object
    HttpUploadCompletionError:
      additionalProperties: false
      properties:
        data:
          $ref: '#/components/schemas/HttpUploadCompletionErrorData'
        description:
          description: A human readable message to the client explaining the cause
            of the exception.
          title: Description
          type: string
        exception_id:
          const: uploadCompletionError
          title: Exception Id
          type: string
      required:
      - data
      - description
      - exception_id
      title: HttpUploadCompletionError
      type: object
    HttpUploadCompletionErrorData:
      properties:
        box_id:
          format: uuid4
          title: Box Id
          type: string
        file_id:
          format: uuid4
          title: File Id
          type: string
      required:
      - box_id
      - file_id
      title: HttpUploadCompletionErrorData
      type: object
    ValidationError:
      properties:
        ctx:
          title: Context
          type: object
        input:
          title: Input
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          title: Location
          type: array
        msg:
          title: Message
          type: string
        type:
          title: Error Type
          type: string
      required:
      - loc
      - msg
      - type
      title: ValidationError
      type: object
  securitySchemes:
    HTTPBearer:
      scheme: bearer
      type: http
info:
  description: A service managing uploads of file objects to an S3-compatible Object
    Storage.
  title: Upload Controller Service
  version: 10.1.0
openapi: 3.1.0
paths:
  /boxes:
    post:
      description: 'Create a new FileUploadBox.


        Requires CreateFileBoxWorkOrder token and only allowed for Data Stewards via
        the UOS.

        Request body should contain the storage alias to use for uploads within the
        box.

        Returns the box_id of the newly created FileUploadBox.'
      operationId: createBox
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BoxCreationRequest'
        required: true
      responses:
        '201':
          content:
            application/json:
              schema:
                format: uuid4
                title: Response Createbox
                type: string
          description: The box_id of the newly created FileUploadBox
        '404':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpUnknownStorageAliasError'
          description: 'Exceptions by ID:

            - noSuchStorage: The storage node for the given alias does not exist.'
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Create a new FileUploadBox
      tags:
      - UploadControllerService
  /boxes/{box_id}:
    get:
      description: Retrieve an existing FileUploadBox
      operationId: getBox
      parameters:
      - in: path
        name: box_id
        required: true
        schema:
          format: uuid4
          title: Box Id
          type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FileUploadBox'
          description: The requested FileUploadBox
        '404':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpBoxNotFoundError'
          description: 'Exceptions by ID:

            - boxNotFound: The FileUploadBox with the given ID does not exist.'
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Retrieve an existing FileUploadBox
      tags:
      - UploadControllerService
    patch:
      description: 'Update a FileUploadBox to lock or unlock it.


        Request body must indicate whether the box is meant to be locked or unlocked.

        Requires ChangeFileBoxWorkOrder token from the UOS. Users are only allowed
        to lock

        the box; a Data Steward role is required to unlock it.'
      operationId: updateBox
      parameters:
      - in: path
        name: box_id
        required: true
        schema:
          format: uuid4
          title: Box Id
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BoxUpdateRequest'
        required: true
      responses:
        '204':
          description: FileUploadBox successfully updated
        '404':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpBoxNotFoundError'
          description: 'Exceptions by ID:

            - boxNotFound: The FileUploadBox with the given ID does not exist.'
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Update a FileUploadBox (lock/unlock)
      tags:
      - UploadControllerService
  /boxes/{box_id}/uploads:
    get:
      description: 'Retrieve list of FileUploads for a FileUploadBox.


        Returns the list of FileUploads for completed uploads in the specified box.

        Requires ViewFileBoxWorkOrder token from the UOS.'
      operationId: getBoxUploads
      parameters:
      - in: path
        name: box_id
        required: true
        schema:
          format: uuid4
          title: Box Id
          type: string
      responses:
        '200':
          content:
            application/json:
              schema:
                items:
                  $ref: '#/components/schemas/FileUpload'
                title: Response Getboxuploads
                type: array
          description: List of file IDs for completed uploads in the box
        '404':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpBoxNotFoundError'
          description: 'Exceptions by ID:

            - boxNotFound: The FileUploadBox with the given ID does not exist.'
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Retrieve list of file IDs for box
      tags:
      - UploadControllerService
    post:
      description: 'Add a new FileUpload to an existing FileUploadBox.


        Creates a new file upload within the specified box with the provided alias,
        checksum, and size.

        Initiates a multipart upload and returns the file ID for the newly created
        upload.

        Requires a CreateFileWorkOrder token from the WPS.'
      operationId: createFileUpload
      parameters:
      - in: path
        name: box_id
        required: true
        schema:
          format: uuid4
          title: Box Id
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FileUploadCreationRequest'
        required: true
      responses:
        '201':
          content:
            application/json:
              schema:
                format: uuid4
                title: Response Createfileupload
                type: string
          description: The file_id of the newly created FileUpload
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpUnknownStorageAliasError'
          description: 'Exceptions by ID:

            - noSuchStorage: The storage node for the given alias does not exist.'
        '404':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpBoxNotFoundError'
          description: 'Exceptions by ID:

            - boxNotFound: The FileUploadBox with the given ID does not exist.'
        '409':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpNotEnoughSpaceError'
          description: 'Exceptions by ID:

            - notEnoughSpace: The file size would exceed the remaining space allowed
            for the FileUploadBox.'
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Add a new FileUpload to an existing FileUploadBox
      tags:
      - UploadControllerService
  /boxes/{box_id}/uploads/{file_id}:
    delete:
      description: 'Remove a FileUpload from the FileUploadBox.


        Deletes the FileUpload and tells S3 to cancel the multipart upload if applicable.

        Requires a DeleteFileWorkOrder token from the WPS.'
      operationId: removeFileUpload
      parameters:
      - in: path
        name: box_id
        required: true
        schema:
          format: uuid4
          title: Box Id
          type: string
      - in: path
        name: file_id
        required: true
        schema:
          format: uuid4
          title: File Id
          type: string
      responses:
        '204':
          description: FileUpload removed successfully
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpUnknownStorageAliasError'
          description: 'Exceptions by ID:

            - noSuchStorage: The storage node for the given alias does not exist.'
        '404':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpS3UploadDetailsNotFoundError'
          description: 'Exceptions by ID:

            - s3UploadDetailsNotFound: S3 upload details for the file could not be
            found.'
        '409':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpLockedBoxError'
          description: 'Exceptions by ID:

            - lockedBox: The FileUploadBox is locked and cannot be modified.'
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
        '500':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpUploadAbortError'
          description: 'Exceptions by ID:

            - uploadAbortError: There was an error aborting the s3 multipart upload.'
      security:
      - HTTPBearer: []
      summary: Remove a FileUpload from the FileUploadBox
      tags:
      - UploadControllerService
    patch:
      description: 'Complete file upload by instructing S3 to finalize the multipart
        upload.


        Concludes the file upload process in UCS by instructing S3 to complete the

        multipart upload for the specified file.

        Requires a CloseFileWorkOrder token from the WPS.'
      operationId: completeFileUpload
      parameters:
      - in: path
        name: box_id
        required: true
        schema:
          format: uuid4
          title: Box Id
          type: string
      - in: path
        name: file_id
        required: true
        schema:
          format: uuid4
          title: File Id
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FileUploadCompletionRequest'
        required: true
      responses:
        '204':
          description: File upload completed successfully
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpChecksumMismatchError'
          description: 'Exceptions by ID:

            - checksumMismatch: The user-supplied encrypted checksum doesn''t match
            S3.'
        '404':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpFileUploadNotFoundError'
          description: 'Exceptions by ID:

            - fileUploadNotFound: The FileUpload could not be found.'
        '409':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpLockedBoxError'
          description: 'Exceptions by ID:

            - lockedBox: The FileUploadBox is locked and cannot be modified.'
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
        '500':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpUploadCompletionError'
          description: 'Exceptions by ID:

            - s3UploadCompletionFailure: There was an error completing the s3 multipart
            upload. Delete the file from the file upload box and retry.'
      security:
      - HTTPBearer: []
      summary: Complete file upload
      tags:
      - UploadControllerService
  /boxes/{box_id}/uploads/{file_id}/parts/{part_no}:
    get:
      description: 'Get pre-signed S3 upload URL for a specific file part.


        Returns a pre-signed URL that can be used to upload the bytes for the specified

        part number of the specified file upload.

        Requires an UploadFileWorkOrder token from the WPS.'
      operationId: getPartUploadUrl
      parameters:
      - in: path
        name: box_id
        required: true
        schema:
          format: uuid4
          title: Box Id
          type: string
      - in: path
        name: file_id
        required: true
        schema:
          format: uuid4
          title: File Id
          type: string
      - in: path
        name: part_no
        required: true
        schema:
          title: Part No
          type: integer
      responses:
        '200':
          content:
            application/json:
              schema:
                title: Response Getpartuploadurl
                type: string
          description: The pre-signed URL for uploading the file part
        '400':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpUnknownStorageAliasError'
          description: 'Exceptions by ID:

            - noSuchStorage: The storage node for the given alias does not exist.'
        '404':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HttpS3UploadNotFoundError'
          description: 'Exceptions by ID:

            - s3UploadNotFound: The S3 multipart upload could not be found.'
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Get pre-signed S3 upload URL for file part
      tags:
      - UploadControllerService
  /health:
    get:
      description: Used to test if this service is alive
      operationId: health_health_get
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
      summary: health
      tags:
      - UploadControllerService
tags:
- name: UploadControllerService
